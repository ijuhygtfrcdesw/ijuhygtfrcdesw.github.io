<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test 003</title>
  <link rel="icon" href="system/images/bguhm.png">
  <link rel="stylesheet" href="system/css/main.css">
  <link rel="stylesheet" href="system/css/quote.css">
  <link rel="stylesheet" href="system/css/themes.css">
  <link rel="stylesheet" href="system/css/commands.css">
  <meta name="author" content="Bg.uhm by rhap5ody">
  <meta name="keywords" content="fun, library, github, rhap5ody">

  <!-- Core scripts -->
  <script src="system/js/quote.js" defer></script>
  <script src="system/js/settings.js" defer></script>
  <script src="system/js/carousel.js" defer></script>
  <script src="system/js/commands.js" defer></script>

  <!-- Discord Widget -->
  <script src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3" async defer>
    new Crate({
      server: '1273329263923302430',
      channel: '1329289920845713471'
    })
  </script>

  <!-- Styles -->
  <style>
    .update-popup {
      position: fixed; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.65); backdrop-filter: blur(6px);
      z-index: 9999; opacity: 0; pointer-events: none;
      transition: opacity 0.5s ease;
    }
    .update-popup.show { opacity: 1; pointer-events: all; }
    .update-popup-content {
      background: var(--background-color,#1e1e1e);
      border-radius: 14px; box-shadow: 0 0 20px rgba(0,0,0,0.6);
      width: 90%; max-width: 480px; text-align: center;
      padding: 20px; color: var(--text-color,#fff);
      animation: popup-bounce 0.6s ease;
    }
    .update-video-wrapper { position: relative; border-radius: 10px; overflow: hidden; }
    .video-tooltip {
      position: absolute; bottom: 8px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: #fff;
      padding: 4px 8px; border-radius: 6px; font-size: 0.8em;
      opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
    }
    .update-video-wrapper:hover .video-tooltip { opacity: 1; }
    @keyframes popup-bounce {
      0% { transform: scale(0.9); opacity: 0; }
      60% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); }
    }
    #searchInputHeader { transition: opacity 0.5s ease; }
    #searchInputHeader.fade-out { opacity: 0; }
    #searchInputHeader.fade-in { opacity: 1; }

    /* Game cards */
    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      padding: 20px;
    }
    .game-card {
      background: #222;
      color: white;
      border-radius: 10px;
      text-align: center;
      padding: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      transition: transform 0.2s ease;
    }
    .game-card:hover { transform: scale(1.05); }
    .game-card img {
      width: 100%; height: 100px; object-fit: cover;
      border-radius: 8px; margin-bottom: 8px;
    }
  </style>
</head>
<body>

<header>
  <nav class="nav-links">
    <a href="system/pages/home.html">Home</a>
    <a href="system/pages/favorite.html">Favorites</a>
    <a href="system/pages/discover.html">Discovery</a>
    <a href="system/pages/settings.html">Settings</a>
    <a href="system/pages/support.html">Support</a>
    <a href="system/pages/info.html">Info</a>

    <div class="pages-anchor">
      <button class="arrowleft" onclick="prevPage()"><img src="system/icons/left.png" alt="Previous"></button>
      <span class="page-indicator">...</span>
      <button class="arrowright" onclick="nextPage()"><img src="system/icons/right.png" alt="Next"></button>
    </div>
  </nav>

  <div class="header-controls">
    <div class="search-box">
      <input type="text" id="searchInputHeader" placeholder="Search games...">
      <button id="searchBtnHeader"><img src="system/icons/search.png" alt="Search"></button>
    </div>
    <a href="system/pages/profile.html"><img src="system/icons/profile.png" alt="profile" id="pfp"></a>
    <img src="system/icons/dashboard.png" alt="Dashboard" id="dashboardBtn">
  </div>
</header>

<div id="quoteWrapper"><p id="quoteBox"></p></div>

<!-- Popup -->
<div id="updatePopup" class="update-popup">
  <div class="update-popup-content">
    <h2>🎉 Version 0.8 Update!</h2>
    <p>New games, smoother loading, and visual tweaks across the library!</p>
    <div class="update-video-wrapper">
      <iframe id="updateVideo" width="100%" height="200"
        src="https://www.youtube.com/embed/Ik4Cgquw-D8?si=JPMig9VTfb-PYVNg&controls=0"
        title="v0.8 Update Trailer" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
      <div class="video-tooltip">Press F or double click for full screen</div>
    </div>
    <div class="update-buttons">
      <button id="viewUpdateBtn">Check it out!</button>
      <button id="viewUpdateInfoBtn">More information</button>
      <button id="closeUpdateBtn">Close</button>
      <button id="dontShowBtn">Don’t show again</button>
    </div>
  </div>
</div>

<main>
  <div id="container" class="game-grid">Loading assets...</div>
</main>

<button id="toTopBtn">⬆ Top</button>

<footer>
  <a href="system/pages/sources.html">Sources</a>
  <a href="system/pages/contributors.html">Contribute</a>
  <a href="system/pages/discord.html">Discord</a>
  <a href="system/pages/bugsNfixes.html">Bugs & fixes</a>
  <a href="system/pages/contact.html">Socials</a>
  <a href="system/pages/version-log.html">version V0.7.2</a>
</footer>

<div id="dashboardMenu" class="dashboard-menu">
  <a href="system/pages/music-player.html">Music Player</a>
  <a href="system/pages/settings-themes.html">Themes</a>
  <a href="system/pages/credits.html">Credits</a>
  <a href="system/pages/alt.html">Alternative Links</a>
</div>

<!-- Scripts -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const popup = document.getElementById("updatePopup");
  const video = document.getElementById("updateVideo");
  const closeBtn = document.getElementById("closeUpdateBtn");
  const viewUpdateBtn = document.getElementById("viewUpdateBtn");
  const viewInfoBtn = document.getElementById("viewUpdateInfoBtn");
  const dontShowBtn = document.getElementById("dontShowBtn");
  const currentVersion = "v0.8";
  const storedVersion = localStorage.getItem("dismissedUpdateVersion");

  if (storedVersion !== currentVersion && !sessionStorage.getItem("updatePopupClosed")) {
    setTimeout(() => popup.classList.add("show"), 1500);
  }

  const stopVideo = () => { const s = video.src; video.src = ""; video.src = s; };

  closeBtn.onclick = () => { popup.classList.remove("show"); sessionStorage.setItem("updatePopupClosed","true"); stopVideo(); };
  dontShowBtn.onclick = () => { localStorage.setItem("dismissedUpdateVersion", currentVersion); popup.classList.remove("show"); stopVideo(); };
  viewUpdateBtn.onclick = () => window.open("system/pages/updates.html", "_blank");
  viewInfoBtn.onclick = () => window.open("system/pages/update-info.html", "_blank");
});

// Scroll to Top
const toTopBtn = document.getElementById("toTopBtn");
window.onscroll = () => toTopBtn.style.display = (window.scrollY > 300) ? "block" : "none";
toTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: "smooth" });

// Profile picture
document.addEventListener("DOMContentLoaded", () => {
  const savedPic = localStorage.getItem("profilePic");
  if (savedPic) document.getElementById("pfp").src = savedPic;
});

// --- Live Search ---
document.addEventListener("DOMContentLoaded", async () => {
  const input = document.getElementById("searchInputHeader");
  const container = document.getElementById("container");
  let games = [];

  try {
    const res = await fetch("system/data/games.json");
    games = await res.json();
    renderGames(games);
  } catch (err) {
    container.textContent = "⚠️ Failed to load games.";
  }

  function renderGames(list) {
    container.innerHTML = list.map(g => `
      <div class="game-card">
        <img src="${g.image}" alt="${g.title}">
        <h3>${g.title}</h3>
        <p>${g.author}</p>
      </div>
    `).join("");
  }

  input.addEventListener("input", e => {
    const q = e.target.value.toLowerCase().trim();
    const filtered = games.filter(g => g.title.toLowerCase().includes(q) || g.author.toLowerCase().includes(q));
    renderGames(filtered);
  });
});
</script>

</body>
</html>
