<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discovery | 10x76</title>
  <link rel="icon" href="../images/10x76.png" />
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="../css/themes.css" />
  <style>
    body { padding: 1rem 2rem; color: #fff; font-family: 'Segoe UI', sans-serif; }
    h1, h2, h3 { margin: 0.5em 0; }
    h1 { font-size: 2em; text-align: center; }
    .category { margin-top: 2em; border-top: 2px solid var(--accent-color,#6a0dad); padding-top: 1em; }
    .subcategory { margin-top: 1.2em; }
    .subcategory h3 { color: var(--accent-color,#c77dff); }
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 0.6em;
    }
    .game-card {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 0.5em;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .game-card:hover {
      transform: scale(1.04);
      box-shadow: 0 0 10px rgba(255,255,255,0.2);
    }
    .game-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      background: #111;
    }
    .game-card h4 { margin: 0.4em 0 0.2em; font-size: 1em; }
    .game-card p { margin: 0; font-size: 0.85em; color: #bbb; }
    a { text-decoration: none; color: inherit; }
    .soon { opacity: 0.6; pointer-events: none; }
  </style>
</head>
<body>
  <h1>ðŸŽ® Discover Games</h1>
  <div id="discoveryContainer">Loading categories...</div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const container = document.getElementById("discoveryContainer");
      const jsonPath = "../json/assets.json";
      const fallbackImage = "https://raw.githubusercontent.com/theworldpt1/theworldpt1.github.io/main/system/images/404_blank.png";
      const fallbackLink = "https://theworldpt1.github.io./source/dino/";

      try {
        const res = await fetch(jsonPath);
        if (!res.ok) throw new Error("Failed to load JSON");
        const games = await res.json();

        // --- Group by category and subcategory ---
        const grouped = {};
        games.forEach(game => {
          const cat = (game.category || "Uncategorized").trim() || "Uncategorized";
          const sub = (game["sub-category"] || "Misc").trim() || "Misc";
          if (!grouped[cat]) grouped[cat] = {};
          if (!grouped[cat][sub]) grouped[cat][sub] = [];
          grouped[cat][sub].push(game);
        });

        // --- Build HTML ---
        container.innerHTML = "";
        for (const [category, subcats] of Object.entries(grouped)) {
          const catDiv = document.createElement("div");
          catDiv.className = "category";
          catDiv.innerHTML = `<h2>${category}</h2>`;

          for (const [sub, gamesList] of Object.entries(subcats)) {
            const subDiv = document.createElement("div");
            subDiv.className = "subcategory";
            subDiv.innerHTML = `<h3>${sub}</h3>`;

            const grid = document.createElement("div");
            grid.className = "games-grid";

            gamesList.forEach(game => {
              let imgSrc = game.image?.trim() || "";
              let linkSrc = game.link?.trim() || "";
              if (!imgSrc || imgSrc.toLowerCase() === "blank" || game.status?.toLowerCase() === "blank")
                imgSrc = fallbackImage;
              if (!linkSrc) linkSrc = fallbackLink;

              const card = document.createElement("div");
              card.className = "game-card";
              if (game.status?.toLowerCase() === "soon") card.classList.add("soon");

              const link = document.createElement("a");
              link.href = linkSrc;
              link.target = "_blank";
              link.rel = "noopener";

              const img = document.createElement("img");
              img.src = imgSrc;
              img.alt = game.title || "Game";
              img.onerror = () => { img.src = fallbackImage; };

              const title = document.createElement("h4");
              title.textContent = game.title || "Untitled";

              const author = document.createElement("p");
              author.textContent = game.author || "Unknown";

              link.appendChild(img);
              link.appendChild(title);
              link.appendChild(author);
              card.appendChild(link);
              grid.appendChild(card);
            });

            subDiv.appendChild(grid);
            catDiv.appendChild(subDiv);
          }
          container.appendChild(catDiv);
        }

      } catch (err) {
        console.error(err);
        container.innerHTML = "<p>âš  Failed to load game data.</p>";
      }
    });
  </script>
</body>
</html>
